<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StatCalc - Statistical Calculator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #f5f5f5;
            --container-bg: #ffffff;
            --container-shadow: 0 2px 12px rgba(0,0,0,0.08);
            --header-bg: #4f46e5;
            --header-bg-end: #6366f1;
            --header-text: #ffffff;
            --section-bg: #f8fafc;
            --section-border: #e2e8f0;
            --section-hover-border: #4f46e5;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --input-bg: #ffffff;
            --input-border: #e2e8f0;
            --input-focus: #4f46e5;
            --btn-bg: #4f46e5;
            --btn-bg-end: #6366f1;
            --btn-text: #ffffff;
            --btn-shadow: rgba(79, 70, 229, 0.25);
            --btn-secondary-bg: #f1f5f9;
            --btn-secondary-text: #475569;
            --btn-secondary-border: #e2e8f0;
            --results-bg: #ffffff;
            --results-border: #e2e8f0;
            --results-active-bg: #f0fdf4;
            --results-active-border: #10b981;
            --divider: #e2e8f0;
            --chart-bar: #4f46e5;
            --chart-axis: #94a3b8;
            --chart-label: #64748b;
            --select-bg: #ffffff;
            --tab-active-bg: #4f46e5;
            --tab-active-text: #ffffff;
            --tab-inactive-bg: #f1f5f9;
            --tab-inactive-text: #64748b;
            --tab-inactive-border: #e2e8f0;
            --scatter-point: #4f46e5;
            --scatter-line: #ef4444;
            --copy-success: #10b981;
        }
        
        [data-theme="dark"] {
            --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --container-bg: #1e1e2e;
            --container-shadow: 0 20px 40px rgba(0,0,0,0.3);
            --header-bg: #302060;
            --header-bg-end: #4a2080;
            --header-text: #ffffff;
            --section-bg: #2a2a3e;
            --section-border: #3a3a50;
            --section-hover-border: #7c6aef;
            --text-primary: #e2e8f0;
            --text-secondary: #b0b8c8;
            --text-muted: #8890a0;
            --input-bg: #1e1e2e;
            --input-border: #3a3a50;
            --input-focus: #7c6aef;
            --btn-bg: #6d5ae6;
            --btn-bg-end: #9b6aef;
            --btn-text: #ffffff;
            --btn-shadow: rgba(109, 90, 230, 0.35);
            --btn-secondary-bg: #2a2a3e;
            --btn-secondary-text: #b0b8c8;
            --btn-secondary-border: #3a3a50;
            --results-bg: #1e1e2e;
            --results-border: #3a3a50;
            --results-active-bg: #1a2e1a;
            --results-active-border: #10b981;
            --divider: #3a3a50;
            --chart-bar: #7c6aef;
            --chart-axis: #6a6a80;
            --chart-label: #8890a0;
            --select-bg: #1e1e2e;
            --tab-active-bg: #6d5ae6;
            --tab-active-text: #ffffff;
            --tab-inactive-bg: #2a2a3e;
            --tab-inactive-text: #8890a0;
            --tab-inactive-border: #3a3a50;
            --scatter-point: #7c6aef;
            --scatter-line: #ef4444;
            --copy-success: #10b981;
        }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 16px;
            box-shadow: var(--container-shadow);
            overflow: hidden;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        
        .header {
            background: linear-gradient(135deg, var(--header-bg) 0%, var(--header-bg-end) 100%);
            color: var(--header-text);
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50px;
            width: 56px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 2px;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.5); }
        
        .theme-toggle .toggle-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        [data-theme="dark"] .theme-toggle .toggle-thumb { transform: translateX(26px); }
        
        .theme-toggle-label {
            position: absolute;
            top: 54px;
            right: 20px;
            color: rgba(255,255,255,0.7);
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.05em;
        }
        
        /* Tab navigation */
        .tab-nav {
            display: flex;
            gap: 4px;
            padding: 20px 40px 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab-btn {
            padding: 10px 20px;
            border: 2px solid var(--tab-inactive-border);
            border-bottom: none;
            border-radius: 10px 10px 0 0;
            background: var(--tab-inactive-bg);
            color: var(--tab-inactive-text);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .tab-btn:hover { color: var(--text-primary); }
        
        .tab-btn.active {
            background: var(--tab-active-bg);
            color: var(--tab-active-text);
            border-color: var(--tab-active-bg);
        }
        
        .main { padding: 0 40px 40px; }
        
        .tab-content { display: none; padding-top: 30px; }
        .tab-content.active { display: block; }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        
        .calculator-grid.single { grid-template-columns: 1fr; max-width: 700px; }
        .calculator-grid.triple { grid-template-columns: 1fr 1fr 1fr; }
        
        @media (max-width: 900px) {
            .calculator-grid, .calculator-grid.triple { grid-template-columns: 1fr; gap: 30px; }
            .header h1 { font-size: 1.8rem; }
            .main { padding: 0 20px 20px; }
            .tab-nav { padding: 20px 20px 0; }
            .theme-toggle-label { display: none; }
            .tab-btn { padding: 8px 14px; font-size: 0.85rem; }
        }
        
        .calc-section {
            background: var(--section-bg);
            border-radius: 12px;
            padding: 30px;
            border: 2px solid var(--section-border);
            transition: all 0.3s ease;
        }
        
        .calc-section:hover { border-color: var(--section-hover-border); transform: translateY(-2px); }
        .calc-section.full-width { grid-column: 1 / -1; }
        
        .calc-section h3 {
            color: var(--text-primary);
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group { margin-bottom: 20px; }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 16px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: border-color 0.2s ease, background 0.3s ease;
        }
        
        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--input-focus);
        }
        
        .input-group textarea {
            height: 100px;
            resize: vertical;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }
        
        .input-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
            cursor: pointer;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        @media (max-width: 500px) { .input-row { grid-template-columns: 1fr; } }
        
        .btn {
            background: linear-gradient(135deg, var(--btn-bg) 0%, var(--btn-bg-end) 100%);
            color: var(--btn-text);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px var(--btn-shadow); }
        .btn:active { transform: translateY(0); }
        
        .btn-secondary {
            background: var(--btn-secondary-bg);
            color: var(--btn-secondary-text);
            border: 1px solid var(--btn-secondary-border);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover { border-color: var(--input-focus); color: var(--input-focus); }
        
        .btn-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .results {
            margin-top: 20px;
            padding: 20px;
            background: var(--results-bg);
            border-radius: 8px;
            border: 2px solid var(--results-border);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .results.active { border-color: var(--results-active-border); background: var(--results-active-bg); }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover { border-color: var(--input-focus); color: var(--input-focus); }
        .copy-btn.copied { border-color: var(--copy-success); color: var(--copy-success); }
        
        .stat-result {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid var(--divider);
        }
        
        .stat-result:last-child { border-bottom: none; margin-bottom: 0; }
        
        .stat-label { color: var(--text-secondary); font-weight: 500; }
        
        .stat-value {
            color: var(--text-primary);
            font-weight: 600;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }
        
        .visualization { margin-top: 30px; text-align: center; }
        .chart { width: 100%; height: 300px; margin-top: 20px; }
        
        .helper-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 4px;
            line-height: 1.4;
        }
        
        .footer {
            text-align: center;
            padding: 20px 40px 30px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .footer a { color: var(--text-secondary); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }
        
        /* Example & Formula buttons */
        .example-btns {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        
        .example-btn {
            background: var(--btn-secondary-bg);
            color: var(--text-muted);
            border: 1px dashed var(--btn-secondary-border);
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .example-btn:hover { border-color: var(--input-focus); color: var(--input-focus); border-style: solid; }
        
        .formula-box {
            background: var(--results-bg);
            border: 1px solid var(--divider);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-secondary);
            display: none;
        }
        
        .formula-box.visible { display: block; }
        
        .formula-box .formula-title {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }
        
        .formula-toggle {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: color 0.2s;
        }
        
        .formula-toggle:hover { color: var(--input-focus); }
        
        /* Print styles */
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
            .header { background: none !important; color: #1e293b; padding: 20px; border-bottom: 2px solid #e2e8f0; }
            .header h1 { font-size: 1.8rem; }
            .theme-toggle, .theme-toggle-label { display: none; }
            .tab-nav { display: none; }
            .tab-content { display: block !important; padding-top: 20px; }
            .tab-content::before {
                content: attr(data-print-title);
                display: block;
                font-size: 1.4rem;
                font-weight: 700;
                margin-bottom: 16px;
                color: #1e293b;
                border-bottom: 2px solid #4f46e5;
                padding-bottom: 8px;
            }
            .calc-section { break-inside: avoid; border-color: #e2e8f0; }
            .calc-section:hover { transform: none; border-color: #e2e8f0; }
            .btn, .btn-secondary, .copy-btn, .example-btns, .formula-toggle { display: none; }
            .formula-box { display: block !important; border-color: #e2e8f0; background: #f8fafc; }
            .results { background: #f8fafc; border-color: #e2e8f0; }
            .results.active { background: #f0fdf4; border-color: #10b981; }
            .footer { border-top: 1px solid #e2e8f0; }
            canvas { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>StatCalc</h1>
            <p>Statistical calculations with clear visualizations</p>
            
            <div class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode" role="button" aria-label="Toggle theme">
                <div class="toggle-thumb" id="toggle-icon">‚òÄÔ∏è</div>
            </div>
            <div class="theme-toggle-label" id="theme-label">light mode</div>
        </div>
        
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('basics')">üìä Basics</button>
            <button class="tab-btn" onclick="switchTab('tests')">üéØ Hypothesis Tests</button>
            <button class="tab-btn" onclick="switchTab('regression')">üìà Regression</button>
            <button class="tab-btn" onclick="switchTab('power')">üìê Power & Sample Size</button>
        </nav>
        
        <div class="main">
            <!-- TAB 1: Basics -->
            <div id="tab-basics" class="tab-content active" data-print-title="Descriptive Statistics & Confidence Intervals">
                <div class="calculator-grid">
                    <!-- Descriptive Statistics -->
                    <div class="calc-section">
                        <h3>üìä Descriptive Statistics</h3>
                        <div class="example-btns">
                            <span style="font-size:11px;color:var(--text-muted);align-self:center">Try:</span>
                            <button class="example-btn" onclick="loadExample('desc-exam')">üìù Exam scores</button>
                            <button class="example-btn" onclick="loadExample('desc-heights')">üìè Heights</button>
                            <button class="example-btn" onclick="loadExample('desc-skewed')">üìä Skewed data</button>
                        </div>
                        <div class="input-group">
                            <label for="data-input">Enter your data (comma-separated or one per line):</label>
                            <textarea id="data-input" placeholder="1.2, 2.3, 3.1&#10;4.2&#10;5.0, 6.1"></textarea>
                        </div>
                        <div class="btn-row">
                            <button class="btn" onclick="calculateDescriptive()">Calculate Stats</button>
                            <button class="formula-toggle" onclick="toggleFormula('desc-formula')">üìê Show formulas</button>
                        </div>
                        <div id="desc-formula" class="formula-box">
                            <div class="formula-title">Formulas Used</div>
                            Mean: xÃÑ = Œ£x·µ¢ / n<br>
                            Variance: s¬≤ = Œ£(x·µ¢ ‚àí xÃÑ)¬≤ / (n ‚àí 1)<br>
                            Std Dev: s = ‚àös¬≤<br>
                            Skewness: g‚ÇÅ = [n/((n‚àí1)(n‚àí2))] ¬∑ Œ£[(x·µ¢‚àíxÃÑ)/s]¬≥<br>
                            IQR: Q3 ‚àí Q1 (linear interpolation)
                        </div>
                        
                        <div id="descriptive-results" class="results">
                            <button class="copy-btn" onclick="copyResults('descriptive-results')">üìã Copy</button>
                            <div class="stat-result"><span class="stat-label">Sample Size (n)</span><span class="stat-value" id="desc-n">-</span></div>
                            <div class="stat-result"><span class="stat-label">Mean (xÃÑ)</span><span class="stat-value" id="desc-mean">-</span></div>
                            <div class="stat-result"><span class="stat-label">Median</span><span class="stat-value" id="desc-median">-</span></div>
                            <div class="stat-result"><span class="stat-label">Standard Deviation (s)</span><span class="stat-value" id="desc-std">-</span></div>
                            <div class="stat-result"><span class="stat-label">Variance (s¬≤)</span><span class="stat-value" id="desc-var">-</span></div>
                            <div class="stat-result"><span class="stat-label">Min / Max</span><span class="stat-value" id="desc-range">-</span></div>
                            <div class="stat-result"><span class="stat-label">IQR (Q1 ‚Äì Q3)</span><span class="stat-value" id="desc-iqr">-</span></div>
                            <div class="stat-result"><span class="stat-label">Skewness</span><span class="stat-value" id="desc-skew">-</span></div>
                        </div>
                        
                        <div class="visualization">
                            <canvas id="histogram" class="chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Confidence Intervals -->
                    <div class="calc-section">
                        <h3>üìè Confidence Intervals</h3>
                        <div class="example-btns">
                            <span style="font-size:11px;color:var(--text-muted);align-self:center">Try:</span>
                            <button class="example-btn" onclick="loadExample('ci-textbook')">üìñ Textbook example</button>
                            <button class="example-btn" onclick="loadExample('ci-small')">üî¨ Small sample</button>
                        </div>
                        <div class="input-group">
                            <label for="ci-mean">Sample Mean (xÃÑ):</label>
                            <input type="number" id="ci-mean" step="any" placeholder="e.g., 23.5">
                        </div>
                        <div class="input-group">
                            <label for="ci-std">Sample Standard Deviation (s):</label>
                            <input type="number" id="ci-std" step="any" placeholder="e.g., 4.2">
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="ci-n">Sample Size (n):</label>
                                <input type="number" id="ci-n" placeholder="e.g., 30">
                            </div>
                            <div class="input-group">
                                <label for="ci-level">Confidence Level:</label>
                                <select id="ci-level">
                                    <option value="90">90%</option>
                                    <option value="95" selected>95%</option>
                                    <option value="99">99%</option>
                                </select>
                            </div>
                        </div>
                        <div class="btn-row">
                            <button class="btn" onclick="calculateCI()">Calculate CI</button>
                            <button class="btn-secondary" onclick="fillCIFromDescriptive()">‚Üê Fill from descriptive</button>
                            <button class="formula-toggle" onclick="toggleFormula('ci-formula')">üìê Show formulas</button>
                        </div>
                        <div id="ci-formula" class="formula-box">
                            <div class="formula-title">Formulas Used</div>
                            Standard Error: SE = s / ‚àön<br>
                            t-critical: t* from Student's t-distribution at df = n‚àí1<br>
                            Margin of Error: E = t* √ó SE<br>
                            Confidence Interval: xÃÑ ¬± E = [xÃÑ ‚àí E, xÃÑ + E]
                        </div>
                        
                        <div id="ci-results" class="results">
                            <button class="copy-btn" onclick="copyResults('ci-results')">üìã Copy</button>
                            <div class="stat-result"><span class="stat-label">Standard Error</span><span class="stat-value" id="ci-se">-</span></div>
                            <div class="stat-result"><span class="stat-label">t-critical value</span><span class="stat-value" id="ci-tcrit">-</span></div>
                            <div class="stat-result"><span class="stat-label">Margin of Error</span><span class="stat-value" id="ci-margin">-</span></div>
                            <div class="stat-result"><span class="stat-label">Lower Bound</span><span class="stat-value" id="ci-lower">-</span></div>
                            <div class="stat-result"><span class="stat-label">Upper Bound</span><span class="stat-value" id="ci-upper">-</span></div>
                            <div class="stat-result"><span class="stat-label">Confidence Interval</span><span class="stat-value" id="ci-interval">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB 2: Hypothesis Tests -->
            <div id="tab-tests" class="tab-content" data-print-title="Hypothesis Tests">
                <div class="calculator-grid">
                    <!-- One-Sample t-Test -->
                    <div class="calc-section">
                        <h3>üéØ One-Sample t-Test</h3>
                        <div class="example-btns">
                            <span style="font-size:11px;color:var(--text-muted);align-self:center">Try:</span>
                            <button class="example-btn" onclick="loadExample('t1-sig')">‚úì Significant result</button>
                            <button class="example-btn" onclick="loadExample('t1-nonsig')">‚úó Non-significant</button>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="t-mean">Sample Mean (xÃÑ):</label>
                                <input type="number" id="t-mean" step="any" placeholder="e.g., 23.5">
                            </div>
                            <div class="input-group">
                                <label for="t-std">Sample Std Dev (s):</label>
                                <input type="number" id="t-std" step="any" placeholder="e.g., 4.2">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="t-n">Sample Size (n):</label>
                                <input type="number" id="t-n" placeholder="e.g., 30">
                            </div>
                            <div class="input-group">
                                <label for="t-null">Null Hypothesis Mean (Œº‚ÇÄ):</label>
                                <input type="number" id="t-null" step="any" placeholder="e.g., 20.0">
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="t-tail">Test Type:</label>
                            <select id="t-tail">
                                <option value="two" selected>Two-tailed (Œº ‚â† Œº‚ÇÄ)</option>
                                <option value="left">Left-tailed (Œº &lt; Œº‚ÇÄ)</option>
                                <option value="right">Right-tailed (Œº &gt; Œº‚ÇÄ)</option>
                            </select>
                        </div>
                        <div class="btn-row">
                        <button class="btn" onclick="calculateTTest()">Run t-Test</button>
                        <button class="formula-toggle" onclick="toggleFormula('t1-formula')">üìê Show formulas</button>
                        </div>
                        <div id="t1-formula" class="formula-box">
                            <div class="formula-title">Formulas Used</div>
                            t-statistic: t = (xÃÑ ‚àí Œº‚ÇÄ) / (s / ‚àön)<br>
                            Degrees of freedom: df = n ‚àí 1<br>
                            Cohen's d: d = |xÃÑ ‚àí Œº‚ÇÄ| / s<br>
                            p-value from Student's t-distribution
                        </div>
                        
                        <div id="ttest-results" class="results">
                            <button class="copy-btn" onclick="copyResults('ttest-results')">üìã Copy</button>
                            <div class="stat-result"><span class="stat-label">t-statistic</span><span class="stat-value" id="t-stat">-</span></div>
                            <div class="stat-result"><span class="stat-label">Degrees of Freedom</span><span class="stat-value" id="t-df">-</span></div>
                            <div class="stat-result"><span class="stat-label">p-value</span><span class="stat-value" id="t-pvalue">-</span></div>
                            <div class="stat-result"><span class="stat-label">Result (Œ± = 0.05)</span><span class="stat-value" id="t-result">-</span></div>
                            <div class="stat-result"><span class="stat-label">Effect Size (Cohen's d)</span><span class="stat-value" id="t-cohend">-</span></div>
                        </div>
                    </div>
                    
                    <!-- Two-Sample t-Test -->
                    <div class="calc-section">
                        <h3>‚öñÔ∏è Two-Sample t-Test</h3>
                        <div class="example-btns">
                            <span style="font-size:11px;color:var(--text-muted);align-self:center">Try:</span>
                            <button class="example-btn" onclick="loadExample('t2-drug')">üíä Drug trial</button>
                            <button class="example-btn" onclick="loadExample('t2-equal')">ü§ù Equal groups</button>
                        </div>
                        <p class="helper-text" style="margin-bottom:16px">Compare means of two independent groups (Welch's t-test, unequal variances).</p>
                        <div class="input-group">
                            <label for="t2-data1">Group 1 data (comma-separated or one per line):</label>
                            <textarea id="t2-data1" placeholder="5.2, 6.1, 4.8, 7.0, 5.5" style="height:70px"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="t2-data2">Group 2 data:</label>
                            <textarea id="t2-data2" placeholder="3.8, 4.2, 5.1, 3.9, 4.5" style="height:70px"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="t2-tail">Test Type:</label>
                            <select id="t2-tail">
                                <option value="two" selected>Two-tailed (Œº‚ÇÅ ‚â† Œº‚ÇÇ)</option>
                                <option value="left">Left-tailed (Œº‚ÇÅ &lt; Œº‚ÇÇ)</option>
                                <option value="right">Right-tailed (Œº‚ÇÅ &gt; Œº‚ÇÇ)</option>
                            </select>
                        </div>
                        <div class="btn-row">
                        <button class="btn" onclick="calculateTwoSampleT()">Run t-Test</button>
                        <button class="formula-toggle" onclick="toggleFormula('t2-formula')">üìê Show formulas</button>
                        </div>
                        <div id="t2-formula" class="formula-box">
                            <div class="formula-title">Formulas Used (Welch's t-test)</div>
                            t = (xÃÑ‚ÇÅ ‚àí xÃÑ‚ÇÇ) / ‚àö(s‚ÇÅ¬≤/n‚ÇÅ + s‚ÇÇ¬≤/n‚ÇÇ)<br>
                            df ‚âà (s‚ÇÅ¬≤/n‚ÇÅ + s‚ÇÇ¬≤/n‚ÇÇ)¬≤ / [(s‚ÇÅ¬≤/n‚ÇÅ)¬≤/(n‚ÇÅ‚àí1) + (s‚ÇÇ¬≤/n‚ÇÇ)¬≤/(n‚ÇÇ‚àí1)]<br>
                            Cohen's d = |xÃÑ‚ÇÅ ‚àí xÃÑ‚ÇÇ| / s‚Çö  where s‚Çö = ‚àö[((n‚ÇÅ‚àí1)s‚ÇÅ¬≤ + (n‚ÇÇ‚àí1)s‚ÇÇ¬≤) / (n‚ÇÅ+n‚ÇÇ‚àí2)]
                        </div>
                        
                        <div id="t2-results" class="results">
                            <button class="copy-btn" onclick="copyResults('t2-results')">üìã Copy</button>
                            <div class="stat-result"><span class="stat-label">Group 1: n, xÃÑ, s</span><span class="stat-value" id="t2-g1">-</span></div>
                            <div class="stat-result"><span class="stat-label">Group 2: n, xÃÑ, s</span><span class="stat-value" id="t2-g2">-</span></div>
                            <div class="stat-result"><span class="stat-label">Mean Difference</span><span class="stat-value" id="t2-diff">-</span></div>
                            <div class="stat-result"><span class="stat-label">t-statistic</span><span class="stat-value" id="t2-stat">-</span></div>
                            <div class="stat-result"><span class="stat-label">Degrees of Freedom</span><span class="stat-value" id="t2-df">-</span></div>
                            <div class="stat-result"><span class="stat-label">p-value</span><span class="stat-value" id="t2-pvalue">-</span></div>
                            <div class="stat-result"><span class="stat-label">Result (Œ± = 0.05)</span><span class="stat-value" id="t2-result">-</span></div>
                            <div class="stat-result"><span class="stat-label">Effect Size (Cohen's d)</span><span class="stat-value" id="t2-cohend">-</span></div>
                            <div class="stat-result"><span class="stat-label">95% CI for Difference</span><span class="stat-value" id="t2-ci">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB 3: Regression -->
            <div id="tab-regression" class="tab-content" data-print-title="Linear Regression & Correlation">
                <div class="calculator-grid single">
                    <div class="calc-section">
                        <h3>üìà Linear Regression & Correlation</h3>
                        <div class="example-btns">
                            <span style="font-size:11px;color:var(--text-muted);align-self:center">Try:</span>
                            <button class="example-btn" onclick="loadExample('reg-study')">üìö Study hours vs score</button>
                            <button class="example-btn" onclick="loadExample('reg-weak')">üîÄ Weak correlation</button>
                        </div>
                        <p class="helper-text" style="margin-bottom:16px">Enter paired (x, y) data. One pair per line, separated by comma or tab.</p>
                        <div class="input-group">
                            <label for="reg-data">Data (x, y pairs):</label>
                            <textarea id="reg-data" style="height:140px" placeholder="1, 2.1&#10;2, 3.9&#10;3, 6.2&#10;4, 7.8&#10;5, 10.1"></textarea>
                        </div>
                        <div class="btn-row">
                            <button class="btn" onclick="calculateRegression()">Fit Regression</button>
                            <button class="formula-toggle" onclick="toggleFormula('reg-formula')">üìê Show formulas</button>
                        </div>
                        <div id="reg-formula" class="formula-box">
                            <div class="formula-title">Formulas Used</div>
                            Slope: b‚ÇÅ = Œ£(x·µ¢‚àíxÃÑ)(y·µ¢‚àí»≥) / Œ£(x·µ¢‚àíxÃÑ)¬≤<br>
                            Intercept: b‚ÇÄ = »≥ ‚àí b‚ÇÅxÃÑ<br>
                            Correlation: r = Œ£(x·µ¢‚àíxÃÑ)(y·µ¢‚àí»≥) / ‚àö[Œ£(x·µ¢‚àíxÃÑ)¬≤ ¬∑ Œ£(y·µ¢‚àí»≥)¬≤]<br>
                            R¬≤ = r¬≤ (proportion of variance explained)<br>
                            S‚Çë = ‚àö[Œ£(y·µ¢‚àí≈∑·µ¢)¬≤ / (n‚àí2)]
                        </div>
                        
                        <div id="reg-results" class="results">
                            <button class="copy-btn" onclick="copyResults('reg-results')">üìã Copy</button>
                            <div class="stat-result"><span class="stat-label">Sample Size (n)</span><span class="stat-value" id="reg-n">-</span></div>
                            <div class="stat-result"><span class="stat-label">Correlation (r)</span><span class="stat-value" id="reg-r">-</span></div>
                            <div class="stat-result"><span class="stat-label">R¬≤ (coefficient of determination)</span><span class="stat-value" id="reg-r2">-</span></div>
                            <div class="stat-result"><span class="stat-label">Regression Equation</span><span class="stat-value" id="reg-eq">-</span></div>
                            <div class="stat-result"><span class="stat-label">Slope (b‚ÇÅ)</span><span class="stat-value" id="reg-slope">-</span></div>
                            <div class="stat-result"><span class="stat-label">Intercept (b‚ÇÄ)</span><span class="stat-value" id="reg-intercept">-</span></div>
                            <div class="stat-result"><span class="stat-label">Std Error of Estimate (S‚Çë)</span><span class="stat-value" id="reg-se">-</span></div>
                            <div class="stat-result"><span class="stat-label">Slope t-test (H‚ÇÄ: Œ≤‚ÇÅ=0)</span><span class="stat-value" id="reg-ttest">-</span></div>
                        </div>
                        
                        <div class="visualization">
                            <canvas id="scatterplot" class="chart" style="height:350px"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB 4: Power & Sample Size -->
            <div id="tab-power" class="tab-content" data-print-title="Power Analysis & Sample Size">
                <div class="calculator-grid single">
                    <div class="calc-section">
                        <h3>üìê Sample Size & Power</h3>
                        <div class="example-btns">
                            <span style="font-size:11px;color:var(--text-muted);align-self:center">Try:</span>
                            <button class="example-btn" onclick="loadExample('ss-small')">üî¨ Detect small effect</button>
                            <button class="example-btn" onclick="loadExample('ss-large')">üì¢ Detect large effect</button>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="ss-effect">Effect Size (Cohen's d):</label>
                                <input type="number" id="ss-effect" step="any" placeholder="e.g., 0.5" value="0.5">
                                <p class="helper-text">Small: 0.2 ¬∑ Medium: 0.5 ¬∑ Large: 0.8</p>
                            </div>
                            <div class="input-group">
                                <label for="ss-power">Statistical Power:</label>
                                <select id="ss-power">
                                    <option value="0.7">70%</option>
                                    <option value="0.8" selected>80%</option>
                                    <option value="0.9">90%</option>
                                    <option value="0.95">95%</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="ss-alpha">Significance Level (Œ±):</label>
                            <select id="ss-alpha">
                                <option value="0.01">0.01</option>
                                <option value="0.05" selected>0.05</option>
                                <option value="0.1">0.10</option>
                            </select>
                        </div>
                        <div class="btn-row">
                        <button class="btn" onclick="calculateSampleSize()">Calculate Sample Size</button>
                        <button class="formula-toggle" onclick="toggleFormula('ss-formula')">üìê Show formulas</button>
                        </div>
                        <div id="ss-formula" class="formula-box">
                            <div class="formula-title">Formulas Used</div>
                            n = ‚åà((z<sub>Œ±/2</sub> + z<sub>Œ≤</sub>) / d)¬≤‚åâ<br>
                            where z<sub>Œ±/2</sub> = inverse normal CDF at 1‚àíŒ±/2<br>
                            z<sub>Œ≤</sub> = inverse normal CDF at power<br>
                            d = Cohen's d (effect size in std dev units)
                        </div>
                        
                        <div id="samplesize-results" class="results">
                            <button class="copy-btn" onclick="copyResults('samplesize-results')">üìã Copy</button>
                            <div class="stat-result"><span class="stat-label">Required Sample Size (n)</span><span class="stat-value" id="ss-n">-</span></div>
                            <div class="stat-result"><span class="stat-label">Effect Size Interpretation</span><span class="stat-value" id="ss-interpretation">-</span></div>
                            <div class="stat-result"><span class="stat-label">Minimum Detectable Difference</span><span class="stat-value" id="ss-mdd">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            Built by <a href="https://onyxclaw.substack.com" target="_blank">Onyx</a> ¬∑ Toggle ‚òÄÔ∏è/üåô for light/dark mode ¬∑ Print-friendly üñ®Ô∏è
        </div>
    </div>

    <script>
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Theme ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function initTheme() {
            const saved = localStorage.getItem('statcalc-theme');
            if (saved) {
                applyTheme(saved);
            } else {
                // Respect system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                applyTheme(prefersDark ? 'dark' : 'light');
            }
        }
        
        // Listen for system theme changes (only when no manual override)
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('statcalc-theme')) {
                applyTheme(e.matches ? 'dark' : 'light');
                redrawCharts();
            }
        });
        
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            applyTheme(next);
            localStorage.setItem('statcalc-theme', next);
            redrawCharts();
        }
        
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('toggle-icon').textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            document.getElementById('theme-label').textContent = theme + ' mode';
        }
        
        initTheme();
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Formula Toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleFormula(id) {
            const el = document.getElementById(id);
            el.classList.toggle('visible');
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Example Data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function loadExample(key) {
            const examples = {
                // Descriptive
                'desc-exam': { target: 'data-input', data: '72, 85, 91, 68, 77, 83, 95, 62, 88, 79, 74, 90, 81, 67, 86, 73, 92, 78, 84, 70', action: 'calculateDescriptive' },
                'desc-heights': { target: 'data-input', data: '165.2, 170.1, 158.7, 175.3, 162.8, 180.5, 168.4, 172.9, 155.6, 177.2, 163.1, 169.8, 174.7, 160.3, 167.5', action: 'calculateDescriptive' },
                'desc-skewed': { target: 'data-input', data: '1.2, 1.5, 1.8, 2.0, 2.1, 2.3, 2.5, 2.8, 3.1, 3.5, 4.2, 5.1, 6.8, 9.2, 15.7', action: 'calculateDescriptive' },
                // CI
                'ci-textbook': { fields: {'ci-mean': '98.2', 'ci-std': '0.73', 'ci-n': '36', 'ci-level': '95'}, action: 'calculateCI' },
                'ci-small': { fields: {'ci-mean': '52.3', 'ci-std': '8.1', 'ci-n': '8', 'ci-level': '95'}, action: 'calculateCI' },
                // One-sample t
                't1-sig': { fields: {'t-mean': '105.3', 't-std': '12.5', 't-n': '25', 't-null': '100', 't-tail': 'two'}, action: 'calculateTTest' },
                't1-nonsig': { fields: {'t-mean': '101.2', 't-std': '15.8', 't-n': '20', 't-null': '100', 't-tail': 'two'}, action: 'calculateTTest' },
                // Two-sample t
                't2-drug': { targets: {'t2-data1': '8.2, 7.1, 9.3, 6.8, 8.5, 7.9, 9.1, 8.0, 7.5, 8.8', 't2-data2': '5.1, 6.3, 4.8, 5.7, 6.0, 5.5, 4.9, 5.2, 6.1, 5.8'}, fields: {'t2-tail': 'two'}, action: 'calculateTwoSampleT' },
                't2-equal': { targets: {'t2-data1': '23.1, 25.4, 22.8, 24.6, 23.9, 24.2, 23.5', 't2-data2': '24.0, 23.7, 24.8, 23.3, 24.1, 23.6, 24.5'}, fields: {'t2-tail': 'two'}, action: 'calculateTwoSampleT' },
                // Regression
                'reg-study': { target: 'reg-data', data: '1, 52\n2, 58\n3, 65\n4, 71\n5, 78\n6, 82\n7, 88\n8, 91\n9, 95\n10, 97', action: 'calculateRegression' },
                'reg-weak': { target: 'reg-data', data: '1, 45\n2, 62\n3, 38\n4, 55\n5, 70\n6, 42\n7, 68\n8, 51\n9, 59\n10, 48', action: 'calculateRegression' },
                // Sample size
                'ss-small': { fields: {'ss-effect': '0.2', 'ss-power': '0.8', 'ss-alpha': '0.05'}, action: 'calculateSampleSize' },
                'ss-large': { fields: {'ss-effect': '0.8', 'ss-power': '0.9', 'ss-alpha': '0.05'}, action: 'calculateSampleSize' },
            };
            
            const ex = examples[key];
            if (!ex) return;
            
            // Fill single textarea
            if (ex.target) {
                document.getElementById(ex.target).value = ex.data;
            }
            // Fill multiple textareas
            if (ex.targets) {
                for (const [id, val] of Object.entries(ex.targets)) {
                    document.getElementById(id).value = val;
                }
            }
            // Fill input fields / selects
            if (ex.fields) {
                for (const [id, val] of Object.entries(ex.fields)) {
                    document.getElementById(id).value = val;
                }
            }
            // Auto-calculate
            if (ex.action && window[ex.action]) {
                window[ex.action]();
            }
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function switchTab(name) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Copy Results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function copyResults(containerId) {
            const container = document.getElementById(containerId);
            const rows = container.querySelectorAll('.stat-result');
            const text = Array.from(rows).map(row => {
                const label = row.querySelector('.stat-label').textContent;
                const value = row.querySelector('.stat-value').textContent;
                return `${label}: ${value}`;
            }).join('\n');
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = container.querySelector('.copy-btn');
                btn.textContent = '‚úì Copied';
                btn.classList.add('copied');
                setTimeout(() => { btn.textContent = 'üìã Copy'; btn.classList.remove('copied'); }, 2000);
            });
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Statistical Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function mean(arr) { return arr.reduce((a, b) => a + b, 0) / arr.length; }
        
        function median(arr) {
            const s = [...arr].sort((a, b) => a - b);
            const mid = Math.floor(s.length / 2);
            return s.length % 2 === 0 ? (s[mid - 1] + s[mid]) / 2 : s[mid];
        }
        
        function quartile(arr, q) {
            const s = [...arr].sort((a, b) => a - b);
            const pos = (s.length - 1) * q;
            const base = Math.floor(pos);
            const rest = pos - base;
            return s[base + 1] !== undefined ? s[base] + rest * (s[base + 1] - s[base]) : s[base];
        }
        
        function variance(arr) {
            const m = mean(arr);
            return arr.reduce((a, b) => a + (b - m) ** 2, 0) / (arr.length - 1);
        }
        
        function standardDeviation(arr) { return Math.sqrt(variance(arr)); }
        
        function skewness(arr) {
            const n = arr.length;
            if (n < 3) return NaN;
            const m = mean(arr), s = standardDeviation(arr);
            const sum = arr.reduce((a, x) => a + ((x - m) / s) ** 3, 0);
            return (n / ((n - 1) * (n - 2))) * sum;
        }
        
        function parseData(input) {
            return input.replace(/\n/g, ',').split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
        }
        
        function parsePairs(input) {
            return input.trim().split('\n').map(line => {
                const parts = line.split(/[,\t]+/).map(x => parseFloat(x.trim()));
                return parts.length >= 2 && !isNaN(parts[0]) && !isNaN(parts[1]) ? [parts[0], parts[1]] : null;
            }).filter(Boolean);
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ t-distribution ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function lnGamma(z) {
            const c = [0.99999999999980993, 676.5203681218851, -1259.1392167224028,
                771.32342877765313, -176.61502916214059, 12.507343278686905,
                -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
            if (z < 0.5) return Math.log(Math.PI / Math.sin(Math.PI * z)) - lnGamma(1 - z);
            z -= 1;
            let x = c[0];
            for (let i = 1; i < 9; i++) x += c[i] / (z + i);
            const t = z + 7.5;
            return 0.5 * Math.log(2 * Math.PI) + (z + 0.5) * Math.log(t) - t + Math.log(x);
        }
        
        function betaIncomplete(a, b, x) {
            if (x === 0 || x === 1) return x;
            if (x > (a + 1) / (a + b + 2)) return 1 - betaIncomplete(b, a, 1 - x);
            const lnBeta = lnGamma(a) + lnGamma(b) - lnGamma(a + b);
            const front = Math.exp(Math.log(x) * a + Math.log(1 - x) * b - lnBeta) / a;
            let f = 1, c = 1, d = 1 - (a + b) * x / (a + 1);
            if (Math.abs(d) < 1e-30) d = 1e-30;
            d = 1 / d; f = d;
            for (let m = 1; m <= 200; m++) {
                let num = m * (b - m) * x / ((a + 2*m - 1) * (a + 2*m));
                d = 1 + num * d; if (Math.abs(d) < 1e-30) d = 1e-30;
                c = 1 + num / c; if (Math.abs(c) < 1e-30) c = 1e-30;
                d = 1 / d; f *= c * d;
                num = -(a + m) * (a + b + m) * x / ((a + 2*m) * (a + 2*m + 1));
                d = 1 + num * d; if (Math.abs(d) < 1e-30) d = 1e-30;
                c = 1 + num / c; if (Math.abs(c) < 1e-30) c = 1e-30;
                d = 1 / d;
                const delta = c * d; f *= delta;
                if (Math.abs(delta - 1) < 1e-10) break;
            }
            return front * f;
        }
        
        function tCDF(t, df) {
            const x = df / (df + t * t);
            const p = 0.5 * betaIncomplete(df / 2, 0.5, x);
            return t >= 0 ? 1 - p : p;
        }
        
        function tPValue(t, df, tail) {
            if (tail === 'two') return 2 * (1 - tCDF(Math.abs(t), df));
            if (tail === 'left') return tCDF(t, df);
            return 1 - tCDF(t, df);
        }
        
        function tCritical(df, alpha) {
            const target = 1 - alpha / 2;
            let t = 1.96;
            for (let i = 0; i < 50; i++) {
                const p = tCDF(t, df);
                const err = p - target;
                if (Math.abs(err) < 1e-10) break;
                const dp = (tCDF(t + 0.0001, df) - tCDF(t - 0.0001, df)) / 0.0002;
                if (Math.abs(dp) < 1e-15) break;
                t -= err / dp;
            }
            return t;
        }
        
        function erf(x) {
            const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
            const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            const t = 1 / (1 + p * x);
            return sign * (1 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t * Math.exp(-x*x));
        }
        
        function normalCDF(z) { return 0.5 * (1 + erf(z / Math.sqrt(2))); }
        
        function normalInvCDF(p) {
            if (p <= 0) return -Infinity;
            if (p >= 1) return Infinity;
            if (p === 0.5) return 0;
            const a = [-3.969683028665376e+01, 2.209460984245205e+02, -2.759285104469687e+02, 1.383577518672690e+02, -3.066479806614716e+01, 2.506628277459239e+00];
            const b = [-5.447609879822406e+01, 1.615858368580409e+02, -1.556989798598866e+02, 6.680131188771972e+01, -1.328068155288572e+01];
            const c = [-7.784894002430293e-03, -3.223964580411365e-01, -2.400758277161838e+00, -2.549732539343734e+00, 4.374664141464968e+00, 2.938163982698783e+00];
            const d = [7.784695709041462e-03, 3.224671290700398e-01, 2.445134137142996e+00, 3.754408661907416e+00];
            const pLow = 0.02425, pHigh = 1 - pLow;
            let q, r;
            if (p < pLow) {
                q = Math.sqrt(-2 * Math.log(p));
                return (((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) / ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);
            } else if (p <= pHigh) {
                q = p - 0.5; r = q * q;
                return (((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])*q / (((((b[0]*r+b[1])*r+b[2])*r+b[3])*r+b[4])*r+1);
            } else {
                q = Math.sqrt(-2 * Math.log(1 - p));
                return -(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) / ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);
            }
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Saved state for cross-module linking ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let lastDescriptiveData = null;
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Calculator Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        function calculateDescriptive() {
            const input = document.getElementById('data-input').value;
            const data = parseData(input);
            if (data.length === 0) { alert('Please enter valid numeric data'); return; }
            
            lastDescriptiveData = data;
            const q1 = quartile(data, 0.25), q3 = quartile(data, 0.75);
            const sk = skewness(data);
            
            document.getElementById('desc-n').textContent = data.length;
            document.getElementById('desc-mean').textContent = mean(data).toFixed(4);
            document.getElementById('desc-median').textContent = median(data).toFixed(4);
            document.getElementById('desc-std').textContent = standardDeviation(data).toFixed(4);
            document.getElementById('desc-var').textContent = variance(data).toFixed(4);
            document.getElementById('desc-range').textContent = `${Math.min(...data).toFixed(4)} / ${Math.max(...data).toFixed(4)}`;
            document.getElementById('desc-iqr').textContent = `${q1.toFixed(4)} ‚Äì ${q3.toFixed(4)}  (IQR = ${(q3 - q1).toFixed(4)})`;
            document.getElementById('desc-skew').textContent = isNaN(sk) ? 'n < 3' : sk.toFixed(4);
            
            document.getElementById('descriptive-results').classList.add('active');
            drawHistogram(data);
        }
        
        function fillCIFromDescriptive() {
            if (!lastDescriptiveData || lastDescriptiveData.length < 2) {
                alert('Run descriptive stats first');
                return;
            }
            document.getElementById('ci-mean').value = mean(lastDescriptiveData).toFixed(4);
            document.getElementById('ci-std').value = standardDeviation(lastDescriptiveData).toFixed(4);
            document.getElementById('ci-n').value = lastDescriptiveData.length;
        }
        
        function calculateCI() {
            const m = parseFloat(document.getElementById('ci-mean').value);
            const s = parseFloat(document.getElementById('ci-std').value);
            const n = parseInt(document.getElementById('ci-n').value);
            const level = parseInt(document.getElementById('ci-level').value);
            if (isNaN(m) || isNaN(s) || isNaN(n) || n < 2) { alert('Please enter valid numbers (n ‚â• 2)'); return; }
            
            const alpha = (100 - level) / 100;
            const df = n - 1;
            const t = tCritical(df, alpha);
            const se = s / Math.sqrt(n);
            const margin = t * se;
            
            document.getElementById('ci-se').textContent = se.toFixed(4);
            document.getElementById('ci-tcrit').textContent = `t(${df}) = ${t.toFixed(4)}`;
            document.getElementById('ci-margin').textContent = `¬± ${margin.toFixed(4)}`;
            document.getElementById('ci-lower').textContent = (m - margin).toFixed(4);
            document.getElementById('ci-upper').textContent = (m + margin).toFixed(4);
            document.getElementById('ci-interval').textContent = `[${(m - margin).toFixed(4)}, ${(m + margin).toFixed(4)}]`;
            document.getElementById('ci-results').classList.add('active');
        }
        
        function calculateTTest() {
            const sampleMean = parseFloat(document.getElementById('t-mean').value);
            const s = parseFloat(document.getElementById('t-std').value);
            const n = parseInt(document.getElementById('t-n').value);
            const nullMean = parseFloat(document.getElementById('t-null').value);
            const tail = document.getElementById('t-tail').value;
            if (isNaN(sampleMean) || isNaN(s) || isNaN(n) || isNaN(nullMean) || n < 2) { alert('Please enter valid numbers (n ‚â• 2)'); return; }
            
            const se = s / Math.sqrt(n);
            const t = (sampleMean - nullMean) / se;
            const df = n - 1;
            const pValue = tPValue(t, df, tail);
            const cohensD = Math.abs(sampleMean - nullMean) / s;
            const tailLabel = tail === 'two' ? 'two-tailed' : (tail === 'left' ? 'left-tailed' : 'right-tailed');
            
            document.getElementById('t-stat').textContent = t.toFixed(4);
            document.getElementById('t-df').textContent = df;
            document.getElementById('t-pvalue').textContent = `${pValue < 0.0001 ? pValue.toExponential(2) : pValue.toFixed(4)} (${tailLabel})`;
            document.getElementById('t-result').textContent = pValue < 0.05 ? 'Reject H‚ÇÄ ‚úì' : 'Fail to reject H‚ÇÄ';
            document.getElementById('t-cohend').textContent = `${cohensD.toFixed(4)} (${cohensD < 0.2 ? 'negligible' : cohensD < 0.5 ? 'small' : cohensD < 0.8 ? 'medium' : 'large'})`;
            document.getElementById('ttest-results').classList.add('active');
        }
        
        function calculateTwoSampleT() {
            const d1 = parseData(document.getElementById('t2-data1').value);
            const d2 = parseData(document.getElementById('t2-data2').value);
            const tail = document.getElementById('t2-tail').value;
            if (d1.length < 2 || d2.length < 2) { alert('Each group needs at least 2 values'); return; }
            
            const m1 = mean(d1), m2 = mean(d2);
            const s1 = standardDeviation(d1), s2 = standardDeviation(d2);
            const n1 = d1.length, n2 = d2.length;
            const v1 = variance(d1), v2 = variance(d2);
            
            // Welch's t-test
            const se = Math.sqrt(v1/n1 + v2/n2);
            const t = (m1 - m2) / se;
            
            // Welch‚ÄìSatterthwaite degrees of freedom
            const dfNum = (v1/n1 + v2/n2) ** 2;
            const dfDen = (v1/n1)**2/(n1-1) + (v2/n2)**2/(n2-1);
            const df = dfNum / dfDen;
            
            const pValue = tPValue(t, df, tail);
            
            // Pooled SD for Cohen's d
            const pooledSD = Math.sqrt(((n1-1)*v1 + (n2-1)*v2) / (n1+n2-2));
            const cohensD = Math.abs(m1 - m2) / pooledSD;
            
            // 95% CI for mean difference
            const tCrit = tCritical(df, 0.05);
            const margin = tCrit * se;
            
            const tailLabel = tail === 'two' ? 'two-tailed' : (tail === 'left' ? 'left-tailed' : 'right-tailed');
            
            document.getElementById('t2-g1').textContent = `n=${n1}, xÃÑ=${m1.toFixed(4)}, s=${s1.toFixed(4)}`;
            document.getElementById('t2-g2').textContent = `n=${n2}, xÃÑ=${m2.toFixed(4)}, s=${s2.toFixed(4)}`;
            document.getElementById('t2-diff').textContent = (m1 - m2).toFixed(4);
            document.getElementById('t2-stat').textContent = t.toFixed(4);
            document.getElementById('t2-df').textContent = df.toFixed(2);
            document.getElementById('t2-pvalue').textContent = `${pValue < 0.0001 ? pValue.toExponential(2) : pValue.toFixed(4)} (${tailLabel})`;
            document.getElementById('t2-result').textContent = pValue < 0.05 ? 'Reject H‚ÇÄ ‚úì' : 'Fail to reject H‚ÇÄ';
            document.getElementById('t2-cohend').textContent = `${cohensD.toFixed(4)} (${cohensD < 0.2 ? 'negligible' : cohensD < 0.5 ? 'small' : cohensD < 0.8 ? 'medium' : 'large'})`;
            document.getElementById('t2-ci').textContent = `[${(m1-m2-margin).toFixed(4)}, ${(m1-m2+margin).toFixed(4)}]`;
            document.getElementById('t2-results').classList.add('active');
        }
        
        function calculateRegression() {
            const pairs = parsePairs(document.getElementById('reg-data').value);
            if (pairs.length < 3) { alert('Need at least 3 data pairs'); return; }
            
            const xs = pairs.map(p => p[0]), ys = pairs.map(p => p[1]);
            const n = pairs.length;
            const mx = mean(xs), my = mean(ys);
            
            // Sums for regression
            let ssxx = 0, ssyy = 0, ssxy = 0;
            for (let i = 0; i < n; i++) {
                ssxx += (xs[i] - mx) ** 2;
                ssyy += (ys[i] - my) ** 2;
                ssxy += (xs[i] - mx) * (ys[i] - my);
            }
            
            const slope = ssxy / ssxx;
            const intercept = my - slope * mx;
            const r = ssxy / Math.sqrt(ssxx * ssyy);
            const r2 = r * r;
            
            // Standard error of estimate
            let ssr = 0;
            for (let i = 0; i < n; i++) {
                const predicted = intercept + slope * xs[i];
                ssr += (ys[i] - predicted) ** 2;
            }
            const se = Math.sqrt(ssr / (n - 2));
            
            // t-test for slope significance
            const slopeStdErr = se / Math.sqrt(ssxx);
            const tStat = slope / slopeStdErr;
            const df = n - 2;
            const pSlope = tPValue(tStat, df, 'two');
            
            const sign = intercept >= 0 ? '+' : '‚àí';
            const absInt = Math.abs(intercept).toFixed(4);
            
            document.getElementById('reg-n').textContent = n;
            document.getElementById('reg-r').textContent = `${r.toFixed(4)} (${Math.abs(r) < 0.3 ? 'weak' : Math.abs(r) < 0.7 ? 'moderate' : 'strong'})`;
            document.getElementById('reg-r2').textContent = `${r2.toFixed(4)} (${(r2 * 100).toFixed(1)}% variance explained)`;
            document.getElementById('reg-eq').textContent = `≈∑ = ${slope.toFixed(4)}x ${sign} ${absInt}`;
            document.getElementById('reg-slope').textContent = `${slope.toFixed(4)} (SE = ${slopeStdErr.toFixed(4)})`;
            document.getElementById('reg-intercept').textContent = intercept.toFixed(4);
            document.getElementById('reg-se').textContent = se.toFixed(4);
            document.getElementById('reg-ttest').textContent = `t(${df}) = ${tStat.toFixed(4)}, p = ${pSlope < 0.0001 ? pSlope.toExponential(2) : pSlope.toFixed(4)}${pSlope < 0.05 ? ' ‚úì' : ''}`;
            document.getElementById('reg-results').classList.add('active');
            
            drawScatterplot(xs, ys, slope, intercept, r);
        }
        
        function calculateSampleSize() {
            const effect = parseFloat(document.getElementById('ss-effect').value);
            const power = parseFloat(document.getElementById('ss-power').value);
            const alpha = parseFloat(document.getElementById('ss-alpha').value);
            if (isNaN(effect) || effect <= 0) { alert('Please enter a positive effect size'); return; }
            
            const z_alpha = normalInvCDF(1 - alpha / 2);
            const z_beta = normalInvCDF(power);
            const n = Math.ceil(((z_alpha + z_beta) / effect) ** 2);
            
            let interp;
            if (effect < 0.2) interp = 'Very small';
            else if (effect < 0.5) interp = 'Small';
            else if (effect < 0.8) interp = 'Medium';
            else interp = 'Large';
            
            document.getElementById('ss-n').textContent = n;
            document.getElementById('ss-interpretation').textContent = interp;
            document.getElementById('ss-mdd').textContent = `${effect}œÉ (${effect} √ó std dev)`;
            document.getElementById('samplesize-results').classList.add('active');
        }
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Charts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        function getChartColors() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            return {
                bar: isDark ? '#7c6aef' : '#4f46e5',
                axis: isDark ? '#6a6a80' : '#94a3b8',
                label: isDark ? '#8890a0' : '#64748b',
                grid: isDark ? 'rgba(106,106,128,0.2)' : 'rgba(148,163,184,0.3)',
                point: isDark ? '#7c6aef' : '#4f46e5',
                pointFill: isDark ? 'rgba(124,106,239,0.6)' : 'rgba(79,70,229,0.6)',
                line: '#ef4444',
                lineLight: 'rgba(239,68,68,0.15)',
            };
        }
        
        function drawHistogram(data) {
            const canvas = document.getElementById('histogram');
            const ctx = canvas.getContext('2d');
            const colors = getChartColors();
            
            canvas.width = canvas.offsetWidth * devicePixelRatio;
            canvas.height = canvas.offsetHeight * devicePixelRatio;
            ctx.scale(devicePixelRatio, devicePixelRatio);
            
            const width = canvas.offsetWidth, height = canvas.offsetHeight;
            ctx.clearRect(0, 0, width, height);
            
            const min = Math.min(...data), max = Math.max(...data);
            const bins = Math.max(3, Math.min(15, Math.ceil(1 + 3.322 * Math.log10(data.length))));
            const range = max - min || 1;
            const binWidth = range / bins;
            
            const histogram = Array(bins).fill(0);
            data.forEach(v => { let bin = Math.floor((v - min) / binWidth); if (bin >= bins) bin = bins - 1; histogram[bin]++; });
            const maxCount = Math.max(...histogram);
            
            const pad = { top: 30, right: 20, bottom: 45, left: 50 };
            const cw = width - pad.left - pad.right, ch = height - pad.top - pad.bottom;
            const bw = cw / bins;
            
            // Grid
            ctx.strokeStyle = colors.grid; ctx.lineWidth = 1;
            for (let i = 1; i <= 4; i++) {
                const y = pad.top + ch - (i / 4) * ch;
                ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(width - pad.right, y); ctx.stroke();
                ctx.fillStyle = colors.label; ctx.font = '11px SF Mono, Monaco, monospace'; ctx.textAlign = 'right';
                ctx.fillText(Math.round(maxCount * i / 4), pad.left - 8, y + 4);
            }
            
            // Bars
            histogram.forEach((count, i) => {
                const barH = (count / maxCount) * ch;
                const x = pad.left + i * bw, y = pad.top + ch - barH;
                const r = Math.min(4, bw * 0.3), barW = bw * 0.82, bx = x + (bw - barW) / 2;
                ctx.fillStyle = colors.bar;
                ctx.beginPath();
                if (barH > r * 2) {
                    ctx.moveTo(bx, y + r); ctx.arcTo(bx, y, bx + barW, y, r); ctx.arcTo(bx + barW, y, bx + barW, y + barH, r);
                    ctx.lineTo(bx + barW, pad.top + ch); ctx.lineTo(bx, pad.top + ch);
                } else { ctx.rect(bx, y, barW, barH); }
                ctx.fill();
                
                const binStart = min + i * binWidth;
                ctx.fillStyle = colors.label; ctx.font = '10px SF Mono, Monaco, monospace'; ctx.textAlign = 'center';
                if (bins <= 10 || i % 2 === 0) ctx.fillText(binStart.toFixed(1), x + bw / 2, pad.top + ch + 18);
            });
            
            // Axes
            ctx.strokeStyle = colors.axis; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(pad.left, pad.top); ctx.lineTo(pad.left, pad.top + ch); ctx.lineTo(width - pad.right, pad.top + ch); ctx.stroke();
            
            // Title
            ctx.fillStyle = colors.label; ctx.font = '13px -apple-system, BlinkMacSystemFont, sans-serif'; ctx.textAlign = 'center';
            ctx.fillText(`Histogram (n=${data.length}, ${bins} bins)`, width / 2, 18);
            
            // Mean line
            const m = mean(data);
            const meanX = pad.left + ((m - min) / range) * cw;
            if (meanX > pad.left && meanX < width - pad.right) {
                ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 2; ctx.setLineDash([5, 3]);
                ctx.beginPath(); ctx.moveTo(meanX, pad.top); ctx.lineTo(meanX, pad.top + ch); ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = '#ef4444'; ctx.font = '11px -apple-system, sans-serif'; ctx.textAlign = 'left';
                ctx.fillText(`xÃÑ=${m.toFixed(2)}`, meanX + 4, pad.top + 12);
            }
        }
        
        function drawScatterplot(xs, ys, slope, intercept, r) {
            const canvas = document.getElementById('scatterplot');
            const ctx = canvas.getContext('2d');
            const colors = getChartColors();
            
            canvas.width = canvas.offsetWidth * devicePixelRatio;
            canvas.height = canvas.offsetHeight * devicePixelRatio;
            ctx.scale(devicePixelRatio, devicePixelRatio);
            
            const width = canvas.offsetWidth, height = canvas.offsetHeight;
            ctx.clearRect(0, 0, width, height);
            
            const pad = { top: 30, right: 30, bottom: 50, left: 60 };
            const cw = width - pad.left - pad.right, ch = height - pad.top - pad.bottom;
            
            const xMin = Math.min(...xs), xMax = Math.max(...xs);
            const yMin = Math.min(...ys), yMax = Math.max(...ys);
            const xRange = xMax - xMin || 1, yRange = yMax - yMin || 1;
            const xPad = xRange * 0.08, yPad = yRange * 0.08;
            
            const x0 = xMin - xPad, x1 = xMax + xPad;
            const y0 = yMin - yPad, y1 = yMax + yPad;
            
            function toCanvasX(v) { return pad.left + ((v - x0) / (x1 - x0)) * cw; }
            function toCanvasY(v) { return pad.top + ch - ((v - y0) / (y1 - y0)) * ch; }
            
            // Grid
            ctx.strokeStyle = colors.grid; ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad.top + (i / 4) * ch;
                ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(width - pad.right, y); ctx.stroke();
                const yVal = y1 - (i / 4) * (y1 - y0);
                ctx.fillStyle = colors.label; ctx.font = '10px SF Mono, Monaco, monospace'; ctx.textAlign = 'right';
                ctx.fillText(yVal.toFixed(1), pad.left - 8, y + 4);
            }
            for (let i = 0; i <= 4; i++) {
                const x = pad.left + (i / 4) * cw;
                ctx.beginPath(); ctx.moveTo(x, pad.top); ctx.lineTo(x, pad.top + ch); ctx.stroke();
                const xVal = x0 + (i / 4) * (x1 - x0);
                ctx.fillStyle = colors.label; ctx.font = '10px SF Mono, Monaco, monospace'; ctx.textAlign = 'center';
                ctx.fillText(xVal.toFixed(1), x, pad.top + ch + 18);
            }
            
            // Regression line
            const lineX0 = x0, lineX1 = x1;
            const lineY0 = intercept + slope * lineX0, lineY1 = intercept + slope * lineX1;
            ctx.strokeStyle = colors.line; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(toCanvasX(lineX0), toCanvasY(lineY0)); ctx.lineTo(toCanvasX(lineX1), toCanvasY(lineY1)); ctx.stroke();
            
            // Points
            for (let i = 0; i < xs.length; i++) {
                const cx = toCanvasX(xs[i]), cy = toCanvasY(ys[i]);
                ctx.fillStyle = colors.pointFill;
                ctx.strokeStyle = colors.point;
                ctx.lineWidth = 2;
                ctx.beginPath(); ctx.arc(cx, cy, 5, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
            }
            
            // Axes
            ctx.strokeStyle = colors.axis; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(pad.left, pad.top); ctx.lineTo(pad.left, pad.top + ch); ctx.lineTo(width - pad.right, pad.top + ch); ctx.stroke();
            
            // Title
            ctx.fillStyle = colors.label; ctx.font = '13px -apple-system, BlinkMacSystemFont, sans-serif'; ctx.textAlign = 'center';
            ctx.fillText(`Scatter Plot (n=${xs.length}, r=${r.toFixed(3)})`, width / 2, 18);
            
            // Axis labels
            ctx.fillStyle = colors.label; ctx.font = '12px -apple-system, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('x', width / 2, height - 5);
            ctx.save(); ctx.translate(15, pad.top + ch/2); ctx.rotate(-Math.PI/2); ctx.fillText('y', 0, 0); ctx.restore();
        }
        
        function redrawCharts() {
            const input = document.getElementById('data-input').value;
            if (input.trim()) {
                const data = parseData(input);
                if (data.length > 0) drawHistogram(data);
            }
            // Redraw scatterplot if regression results exist
            const regEq = document.getElementById('reg-eq').textContent;
            if (regEq !== '-') {
                const pairs = parsePairs(document.getElementById('reg-data').value);
                if (pairs.length >= 3) {
                    const xs = pairs.map(p => p[0]), ys = pairs.map(p => p[1]);
                    const mx = mean(xs), my = mean(ys);
                    let ssxx = 0, ssyy = 0, ssxy = 0;
                    for (let i = 0; i < pairs.length; i++) {
                        ssxx += (xs[i] - mx) ** 2; ssyy += (ys[i] - my) ** 2; ssxy += (xs[i] - mx) * (ys[i] - my);
                    }
                    const slope = ssxy / ssxx, intercept = my - slope * mx, r = ssxy / Math.sqrt(ssxx * ssyy);
                    drawScatterplot(xs, ys, slope, intercept, r);
                }
            }
        }
        
        window.addEventListener('resize', redrawCharts);
    </script>
</body>
</html>
